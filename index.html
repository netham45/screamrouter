<HTML>
    <HEAD>
      <TITLE>ScreamRouter</TITLE>
      <SCRIPT TYPE="text/javascript">
        const BASEURL = "http://192.168.3.114:8080/"

        function populateSources(){
          callAPI("sources","GET","",populateSourcesCallback);
        }

        function createOption(name, id){
          option = document.createElement("option");
          option.innerHTML = name;
          option.value = id;
          return option;
        }
        
        function populateSourcesCallback(data){
            for (entry in data)
                document.getElementById("sources").appendChild(createOption(data[entry].name + (data[entry].is_group?" [" + data[entry].group_members.join(", ") + "]":""), entry));
        }

        function populateSinks(){
            callAPI("sinks","GET","",populateSinksCallback);
        }

        function populateSinksCallback(data){
            for (entry in data)
                document.getElementById("sinks").appendChild(createOption(data[entry].name + (data[entry].is_group?" [" + data[entry].group_members.join(", ") + "]":""), entry));
        }

        function removeSink(sink_id){
            callAPI("sinks/" + sink_id, "DELETE", "", removeSinkCallback);
        }

        function removeSinkCallback(data)
        {
            location.reload();
        }

        function removeSource(source_id){
            callAPI("sources/" + source_id, "DELETE", "", removeSourceCallback);
        }

        function removeSourceCallback(data)
        {
            location.reload();
        }

        function populateRoutes(){
            callAPI("routes","GET","",populateRoutesCallback);
        }

        function populateRoutesCallback(data){
            for (entry in data)
                document.getElementById("routes").appendChild(createOption(data[entry].name, entry));
        }

        function removeRoute(route_id){
            callAPI("sources/" + route_id, "DELETE", "", removeRouteCallback);
        }

        function removeRouteCallback(data)
        {
            location.reload();
        }

        function load()
        {
            populateSources();
            populateSinks();
            populateRoutes();
        }

        function callAPI(endpoint, method, data, callback){
            // First create an XMLHttprequest object 
            const xhr = new XMLHttpRequest(); 
            xhr.open(method, BASEURL + endpoint, true);
            if (method != "GET")
                xhr.send(data)
            xhr.getResponseHeader("Content-type", "application/json"); 
        
            xhr.onload = function() { 
                const obj = JSON.parse(this.responseText);
                callback(obj)
            }
            xhr.send(); 
        }
        
        window.addEventListener("load", (event) => {
            load();
        });
      </SCRIPT>
    </HEAD>
    <BODY>
      <DIV ID="sourcesdiv">
        <SELECT ID="sources" MULTIPLE>
        </SELECT>
        <BR />
        <INPUT TYPE="BUTTON" VALUE="+ Source Group" />
        <INPUT TYPE="BUTTON" VALUE="- Source Group" />
      </DIV>
      <DIV ID="sinksdiv">
        <SELECT ID="sinks" MULTIPLE>
        </SELECT>
        <BR />
        <INPUT TYPE="BUTTON" VALUE="+ Sink Group" />
        <INPUT TYPE="BUTTON" VALUE="- Sink Group" />
      </DIV>
      <DIV ID="routesdiv">
        <SELECT ID="routes" MULTIPLE>
        </SELECT>
        <BR />
        <INPUT TYPE="BUTTON" VALUE="+ Route" />
        <INPUT TYPE="BUTTON" VALUE="- Route" />
      </DIV>
    </BODY>
  </HTML>